<html>
<head>
<title>Test Page!</title>
    <script src="./libmt63Wasm.js"></script>

    <script type="text/javascript">
    
        var audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        window.onload = function() {
            window.mod = Module();

            window.getMT63SampleRate = mod.cwrap('getSampleRate', 'number');
            window.getMT63Buffer = mod.cwrap('getBuffer', 'number');
            window.encodeMT63 = mod.cwrap('encodeString', 'number', ['string', 'number', 'number']);
        };

        function sendMessage(str) {
            var sampleRate = getMT63SampleRate();
            var length = encodeMT63(str, 2000, 1);
            var srcPtr = getMT63Buffer();

            var srcData = mod.HEAPF32.subarray(srcPtr/4, srcPtr/4 + length);

            var buffer = audioCtx.createBuffer(1, length, sampleRate);
            buffer.copyToChannel(srcData, 0);

            var source = audioCtx.createBufferSource();
            source.buffer = buffer;
            source.connect(audioCtx.destination);
            source.start();
        }

    </script>
</head>
<body>
    This is a test!
</body>
</html>